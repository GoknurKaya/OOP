@model DAL.Models.General.GameBoard
@{
    ViewData["Title"] = "Gemi Yerleştirme";
}

<style>
    body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        margin: 0;
        padding: 20px 0;
    }

    .placement-wrapper {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
    }

    /* Başlık */
    .placement-header {
        text-align: center;
        margin-bottom: 40px;
        animation: fadeInDown 0.6s ease-out;
    }

    .placement-title {
        font-size: 3.5rem;
        font-weight: bold;
        color: white;
        text-shadow: 3px 3px 6px rgba(0,0,0,0.4);
        margin-bottom: 10px;
        letter-spacing: 2px;
    }

    .placement-subtitle {
        font-size: 1.3rem;
        color: rgba(255,255,255,0.9);
        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    /* Ana Konteyner */
    .placement-container {
        display: flex;
        gap: 30px;
        justify-content: center;
        flex-wrap: wrap;
        animation: fadeIn 0.8s ease-out;
    }

    /* Sol Panel - Gemi Listesi ve Kontroller */
    .control-panel {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 15px 50px rgba(0,0,0,0.4);
        width: 350px;
        animation: slideInLeft 0.8s ease-out;
    }

    .panel-section {
        margin-bottom: 30px;
    }

    .panel-title {
        font-size: 1.5rem;
        font-weight: bold;
        color: #333;
        margin-bottom: 20px;
        text-transform: uppercase;
        letter-spacing: 1px;
        border-bottom: 3px solid #667eea;
        padding-bottom: 10px;
    }

    /* Gemi Kartları */
    .ship-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .ship-item {
        padding: 20px;
        margin: 15px 0;
        border: 3px solid #ddd;
        border-radius: 15px;
        cursor: pointer;
        transition: all 0.3s;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        position: relative;
        overflow: hidden;
    }

        .ship-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        .ship-item:hover::before {
            left: 100%;
        }

        .ship-item:hover {
            transform: translateX(10px);
            border-color: #2196f3;
            box-shadow: 0 5px 20px rgba(33, 150, 243, 0.3);
        }

        .ship-item.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
        }

        .ship-item.placed {
            background: linear-gradient(135deg, #4caf50 0%, #81c784 100%);
            color: white;
            border-color: #4caf50;
            cursor: default;
        }

            .ship-item.placed::after {
                content: '✓';
                position: absolute;
                right: 15px;
                top: 50%;
                transform: translateY(-50%);
                font-size: 2rem;
                font-weight: bold;
            }

    .ship-name {
        font-size: 1.3rem;
        font-weight: bold;
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .ship-size {
        font-size: 1rem;
        opacity: 0.9;
    }

    /* Yön Kontrolleri */
    .direction-controls {
        display: flex;
        gap: 15px;
    }

    .direction-btn {
        flex: 1;
        padding: 15px 20px;
        font-size: 1.1rem;
        font-weight: bold;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s;
        color: white;
        text-transform: uppercase;
        letter-spacing: 1px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }

    .btn-horizontal {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .btn-vertical {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }

    .direction-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 20px rgba(0,0,0,0.3);
    }

    .direction-btn.active {
        transform: scale(1.1);
        box-shadow: 0 8px 25px rgba(0,0,0,0.4);
    }

    /* Aksiyon Butonları */
    .action-buttons-panel {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    .action-btn {
        padding: 18px 25px;
        font-size: 1.2rem;
        font-weight: bold;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s;
        color: white;
        text-transform: uppercase;
        letter-spacing: 1px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
    }

    .btn-random {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }

    .btn-start {
        background: linear-gradient(135deg, #4caf50 0%, #81c784 100%);
    }

    .action-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 30px rgba(0,0,0,0.4);
    }

    .action-btn:active {
        transform: translateY(0);
    }

    /* Sağ Panel - Tahta */
    .board-panel {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 15px 50px rgba(0,0,0,0.4);
        animation: slideInRight 0.8s ease-out;
    }

    .board-title {
        text-align: center;
        font-size: 2rem;
        font-weight: bold;
        color: #333;
        margin-bottom: 25px;
        text-transform: uppercase;
        letter-spacing: 2px;
    }

    /* Grid */
    .grid-container {
        display: grid;
        grid-template-columns: repeat(10, 50px);
        grid-template-rows: repeat(10, 50px);
        gap: 3px;
        border: 4px solid #333;
        border-radius: 10px;
        padding: 8px;
        background: linear-gradient(135deg, #434343 0%, #000000 100%);
        box-shadow: inset 0 2px 10px rgba(0,0,0,0.5);
        margin: 0 auto;
    }

    .grid-cell {
        background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
        border: 2px solid #90caf9;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 28px;
        transition: all 0.2s;
        position: relative;
        overflow: hidden;
    }

        .grid-cell::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle, rgba(255,255,255,0.4) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .grid-cell:hover::before {
            opacity: 1;
        }

        .grid-cell:hover {
            transform: scale(1.15);
            z-index: 10;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }

    .status-1 {
        background: linear-gradient(135deg, #4caf50 0%, #81c784 100%);
        color: white;
        box-shadow: 0 0 15px rgba(76, 175, 80, 0.6);
        animation: shipPulse 2s infinite;
    }

    /* Yardımcı Mesaj */
    .help-message {
        text-align: center;
        margin-top: 20px;
        padding: 15px;
        background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
        border-radius: 12px;
        font-size: 1.1rem;
        font-weight: 600;
        color: #2d3436;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }

    
</style>

<div class="placement-wrapper">
    <div class="placement-header">
        <h1 class="placement-title">⚓ GEMİLERİNİZİ YERLEŞTİRİN ⚓</h1>
        <p class="placement-subtitle">Filonuzu stratejik olarak konumlandırın</p>
    </div>

    <div class="placement-container">
        <!-- Sol Panel: Kontroller -->
        <div class="control-panel">
            <!-- Gemi Listesi -->
            <div class="panel-section">
                <h4 class="panel-title">🚢 Filonuz</h4>
                <ul class="ship-list" id="ship-list">
                    @for (int i = 0; i < Model.Fleet.Count; i++)
                    {
                        var ship = Model.Fleet[i];
                        var shipIcon = ship.Size == 4 ? "🚢" : ship.Size == 3 ? "⛴️" : "🛥️";
                        <li class="ship-item" data-ship-index="@i" data-ship-size="@ship.Size">
                            <div class="ship-name">@shipIcon @ship.Name</div>
                            <div class="ship-size">📏 Boyut: @ship.Size kare</div>
                        </li>
                    }
                </ul>
            </div>

            <!-- Yön Kontrolleri -->
            <div class="panel-section">
                <h4 class="panel-title">🧭 Yerleştirme Yönü</h4>
                <div class="direction-controls">
                    <button id="btn-horizontal" class="direction-btn btn-horizontal active">
                        ➡️ Yatay
                    </button>
                    <button id="btn-vertical" class="direction-btn btn-vertical">
                        ⬇️ Dikey
                    </button>
                </div>
            </div>

            <!-- Aksiyon Butonları -->
            <div class="panel-section">
                <div class="action-buttons-panel">
                    <button id="btn-random" class="action-btn btn-random">
                        🎲 Rastgele Yerleştir
                    </button>
                    <button id="btn-start" class="action-btn btn-start">
                        🚀 Savaşa Başla!
                    </button>
                </div>
            </div>
        </div>

        <!-- Sağ Panel: Tahta -->
        <div class="board-panel">
            <h4 class="board-title">🗺️ Savaş Alanınız</h4>
            <div class="grid-container" id="player-board">
                @for (int y = 0; y < 10; y++)
                {
                    for (int x = 0; x < 10; x++)
                    {
                        var cellValue = Model.GridData[x][y];
                        var statusClass = cellValue == 1 ? "status-1" : "";
                        <div class="grid-cell @statusClass" data-x="@x" data-y="@y">
                            @(cellValue == 1 ? "🚢" : "")
                        </div>
                    }
                }
            </div>
            <div class="help-message">
                💡 <strong>İpucu:</strong> Önce bir gemi seçin, sonra tahtaya tıklayın!
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    var selectedShipIndex = -1;
    var isHorizontal = true;
    var shipsPlaced = [false, false, false];

    $(document).ready(function () {
        // Yön butonları
        $('#btn-horizontal').click(function () {
            isHorizontal = true;
            $('#btn-horizontal').addClass('active');
            $('#btn-vertical').removeClass('active');
        });

        $('#btn-vertical').click(function () {
            isHorizontal = false;
            $('#btn-vertical').addClass('active');
            $('#btn-horizontal').removeClass('active');
        });

        // Gemi seçimi
        $('.ship-item').click(function () {
            if ($(this).hasClass('placed')) {
                alert('⚠️ Bu gemi zaten yerleştirildi!\n\nRastgele yerleştir butonuna basarak yeniden başlayabilirsiniz.');
                return;
            }

            $('.ship-item').removeClass('selected');
            $(this).addClass('selected');
            selectedShipIndex = $(this).data('ship-index');
        });

        // Tahtaya gemi yerleştirme
        $('.grid-cell').click(function () {
            if (selectedShipIndex === -1) {
                alert('⚠️ Önce bir gemi seçin!');
                return;
            }

            var x = $(this).data('x');
            var y = $(this).data('y');

            $.ajax({
                url: '@Url.Action("PlaceShip", "Home")',
                type: 'POST',
                data: {
                    shipIndex: selectedShipIndex,
                    startX: x,
                    startY: y,
                    isHorizontal: isHorizontal
                },
                success: function (response) {
                    if (response.success) {
                        updateBoard(response.board);
                        $('.ship-item[data-ship-index="' + selectedShipIndex + '"]')
                            .removeClass('selected')
                            .addClass('placed');
                        shipsPlaced[selectedShipIndex] = true;
                        selectedShipIndex = -1;

                        // Eğer tüm gemiler yerleştirilmişse
                        if (shipsPlaced.every(s => s)) {
                            $('.help-message').html('✅ <strong>Harika!</strong> Tüm gemiler yerleştirildi. Şimdi savaşa başlayabilirsiniz!');
                        }
                    } else {
                        alert('❌ ' + (response.message || 'Gemi bu konuma yerleştirilemez!\n\nBaşka bir yer deneyin.'));
                    }
                },
                error: function () {
                    alert('❌ Bir hata oluştu. Lütfen tekrar deneyin.');
                }
            });
        });

        // Rastgele yerleştir
        $('#btn-random').click(function () {
            $.ajax({
                url: '@Url.Action("PlaceShipsRandomly", "Home")',
                type: 'POST',
                success: function (response) {
                    if (response.success) {
                        updateBoard(response.board);
                        $('.ship-item').removeClass('selected').addClass('placed');
                        shipsPlaced = [true, true, true];
                        selectedShipIndex = -1;
                        $('.help-message').html('✅ <strong>Tamamlandı!</strong> Gemiler rastgele yerleştirildi. Hazır mısınız?');
                    }
                },
                error: function () {
                    alert('❌ Bir hata oluştu.');
                }
            });
        });

        // Oyunu başlat
        $('#btn-start').click(function () {
            if (!shipsPlaced.every(s => s)) {
                alert('⚠️ Önce tüm gemileri yerleştirin!\n\nYa manuel olarak yerleştirin ya da "Rastgele Yerleştir" butonunu kullanın.');
                return;
            }

            $.ajax({
                url: '@Url.Action("StartGame", "Home")',
                type: 'POST',
                success: function (response) {
                    if (response.success) {
                        window.location.href = '@Url.Action("GameScreen", "Home")';
                    } else {
                        alert('❌ ' + (response.message || 'Oyun başlatılamadı.'));
                    }
                },
                error: function () {
                    alert('❌ Bir hata oluştu.');
                }
            });
        });

        // Tahtayı güncelle
        function updateBoard(boardData) {
            for (var x = 0; x < 10; x++) {
                for (var y = 0; y < 10; y++) {
                    var cell = $('.grid-cell[data-x="' + x + '"][data-y="' + y + '"]');
                    cell.removeClass('status-1');
                    cell.text('');

                    if (boardData[x][y] === 1) {
                        cell.addClass('status-1').text('🚢');
                    }
                }
            }
        }
    });
</script>